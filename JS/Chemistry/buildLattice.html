<!DOCTYPE>
<html>
<head>
  <title>Build Lattice</title>
  <script src="../common.js" type="text/javascript"></script>
  <script src="chemical-funcs.js" type="text/javascript"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.js" type="text/javascript"></script>
  <script type="text/javascript">
    $(function(){
      function parseInput(rawText){
        var rows = rawText.split(/\n/).map(function(line){
          return line.split(/\s{1,}/).map(parseFloat);
        });

        return {
          sides: vectorConstructor("a","b","c")(rows[0]),
          angles: vectorConstructor("alpha","beta","gamma")(rows[1]),
          ions: rows.slice(2).map(vectorConstructor("value","x","y","z"))
        };
      }

//      var crystal = chemicalFuncs.buildCrystal({
//        sides: {a:4.11, b:4.11, c:4.11},
//        angles: {alpha:90, beta:90, gamma:90},
//        ions: [
//          {x:0, y:0, z:0, value:1},
//          {x:2.055, y:2.055, z:2.055, value:-1}
//        ]
//      }, 1);

      var tableBuilder = function(attrs){
        var result = "<table " + (attrs && Object.keys(attrs).map(function(attrName){
          return attrName + "=\""+attrs[attrName]+"\"";
        }).join(" ")) + ">", that;
        
        return that = {
          header: function(header){
            that.addRow(header, "th");
            return that;
          },
          addRow: function(cols, colTag){
            colTag = colTag || "td";
            var openTag = "<"+colTag+">",
              closingTag = "</"+colTag+">";
            result += "<tr>" + openTag +
              cols.join(closingTag + openTag) +
              closingTag + "</tr>";
            return that;
          },
          finish: function(){
            return result + "</table>";
          }
        };
      };


      function generateTable(crystal){
        var table = tableBuilder({border:"1px"}).header(["X","Y" ,"Z" ,"V" /*,"Lx" ,"Ly" ,"Lz"*/]);
        crystal.forEach(function(shiftLat){
  //        table.addRow(["","","","",shiftLat.x, shiftLat.y, shiftLat.z]);
          shiftLat.lattice.forEach(function(p){
            table.addRow([p.x, p.y, p.z, p.value]);
          });
        });
        return table.finish();
      }


      $("#submit").click(function(){
        var rawData = $("#input").val();
        var growSize = parseInt($("#growSize").val(), 10);
        var crystal = chemicalFuncs.buildCrystal(parseInput(rawData), growSize);
        
        $("#result").html(generateTable(crystal));
      });
    });
  </script>
</head>
<body>
<label for="input">
  Input:<br/>
<textarea id="input" rows="15" cols="25">4.110 4.110 4.110
90 90 90
1 0.000 0.000 0.000
-1 2.055 2.055 2.055</textarea>
</label>
<br/>
<label for="growSize">
  Grow size: <input id="growSize" value="0" />
</label>
<br/>
<button id="submit">Generate</button>
<div id="result"></div>
</body>
</html>